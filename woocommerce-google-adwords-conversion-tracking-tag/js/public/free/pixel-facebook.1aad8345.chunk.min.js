/*! Copyright 2025 SweetCode. All rights reserved. */
(self.webpackChunkPixel_Manager_for_WooCommerce=self.webpackChunkPixel_Manager_for_WooCommerce||[]).push([[526],{28(){jQuery(document).on("pmw:load-pixels",()=>{!pmwDataLayer?.pixels?.facebook?.pixel_id||pmwDataLayer?.pixels?.facebook?.loaded||pmw.doesUrlContainPatterns(pmwDataLayer?.pixels?.facebook?.exclusion_patterns)||pmw.consent.canPixelBeFired("marketing","Facebook")&&pmw.loadFacebookPixel()}),jQuery(document).on("pmw:pixel:page-view",(e,a)=>{try{if(pmw.canNotFireFbq())return;if(!pmw.shouldFireBrowserPixel(a,"facebook"))return;const e=a.pixels?.facebook;if(!e)return void pmw.console.log("Facebook: No data in payload for page_view event");fbq("track",e.event_name,e.custom_data,{eventID:e.event_id})}catch(e){console.error(e)}}),jQuery(document).on("pmw:pixel:add-to-cart",(e,a)=>{try{if(pmw.canNotFireFbq())return;if(!pmw.shouldFireBrowserPixel(a,"facebook"))return;const e=a.pixels?.facebook;if(!e)return void pmw.console.log("Facebook: No data in payload for add_to_cart event");fbq("track",e.event_name,e.custom_data,{eventID:e.event_id}),pmw.console.log("Facebook Pixel: AddToCart event sent",e)}catch(e){console.error(e)}}),jQuery(document).on("pmw:pixel:begin-checkout",(e,a)=>{try{if(pmw.canNotFireFbq())return;if(!pmw.shouldFireBrowserPixel(a,"facebook"))return;const e=a.pixels?.facebook;if(!e)return;fbq("track",e.event_name,e.custom_data,{eventID:e.event_id}),pmw.console.log("Facebook Pixel: InitiateCheckout event sent",e)}catch(e){console.error(e)}}),jQuery(document).on("pmw:pixel:add-payment-info",(e,a)=>{try{if(pmw.canNotFireFbq())return;if(!pmw.shouldFireBrowserPixel(a,"facebook"))return;const e=a.pixels?.facebook;if(!e)return;fbq("track",e.event_name,e.custom_data,{eventID:e.event_id}),pmw.console.log(`Facebook Pixel: ${e.event_name} event sent`,e)}catch(e){console.error(e)}}),jQuery(document).on("pmw:pixel:add-to-wishlist",(e,a)=>{try{if(pmw.canNotFireFbq())return;if(!pmw.shouldFireBrowserPixel(a,"facebook"))return;const e=a.pixels?.facebook;if(!e)return;fbq("track",e.event_name,e.custom_data,{eventID:e.event_id}),pmw.console.log("Facebook Pixel: AddToWishlist event sent",e)}catch(e){console.error(e)}}),jQuery(document).on("pmw:pixel:view-item",(e,a)=>{try{if(pmw.canNotFireFbq())return;if(!pmw.shouldFireBrowserPixel(a,"facebook"))return;const e=a.pixels?.facebook;if(!e)return;fbq("track",e.event_name,e.custom_data,{eventID:e.event_id}),pmw.console.log("Facebook Pixel: ViewContent event sent",e)}catch(e){console.error(e)}}),jQuery(document).on("pmw:pixel:search",(e,a)=>{try{if(pmw.canNotFireFbq())return;if(!pmw.shouldFireBrowserPixel(a,"facebook"))return;const e=a.pixels?.facebook;if(!e)return;fbq("track",e.event_name,e.custom_data,{eventID:e.event_id}),pmw.console.log("Facebook Pixel: Search event sent",e)}catch(e){console.error(e)}}),jQuery(document).on("pmw:load-always",()=>{try{if(pmw.canNotFireFbq())return;pmw.setFbUserData()}catch(e){console.error(e)}}),jQuery(document).on("pmw:pixel:purchase",(e,a)=>{try{if(pmw.canNotFireFbq())return;if(!pmw.shouldFireBrowserPixel(a,"facebook"))return;const e=a.pixels?.facebook;if(!e)return;fbq("track",e.event_name,e.custom_data,{eventID:e.event_id}),pmw.console.log("Facebook Pixel: Purchase event sent",e)}catch(e){console.error(e)}}),document.addEventListener("pmw:consent:update",({detail:e})=>{const a=e;try{if(!pmwDataLayer?.pixels?.facebook?.loaded)return;const e=a.marketing?"grant":"revoke";fbq("consent",e),pmw.console.log(`Facebook Consent Mode updated: ${e}`)}catch(e){console.error(e)}},!0)},263(){!function(e){let a,t=null;e.fbeventsJsUrl=()=>{let e=new URLSearchParams(window.location.search);return e.has("fbevents-version")?`https://connect.facebook.net/en_US/fbevents.js?v=${e.get("fbevents-version")}`:pmwDataLayer?.pixels?.facebook?.fbevents_js_url},e.loadFacebookPixel=()=>{try{a=window,t=document,r="script",o=e.fbeventsJsUrl(),a.fbq||(n=a.fbq=function(){n.callMethod?n.callMethod.apply(n,arguments):n.queue.push(arguments)},a._fbq||(a._fbq=n),n.push=n,n.loaded=!0,n.version="2.0",n.queue=[],(i=t.createElement(r)).async=!0,i.src=o,(s=t.getElementsByTagName(r)[0]).parentNode.insertBefore(i,s));let c=document.querySelector('script[src*="fbevents.js"]');c&&(c.onload=()=>{e.setFbUserData()},c.onerror=()=>{e.console.error("Facebook Pixel: fbevents.js failed to load")});let p={};e.isFbAdvancedMatchingEnabled()&&(p={...e.getUserIdentifiersForFb()}),fbq("init",pmwDataLayer.pixels.facebook.pixel_id,p),pmwDataLayer?.pixels?.facebook?.mobile_bridge_app_id&&fbq("set","mobileBridge",pmwDataLayer.pixels.facebook.pixel_id,pmwDataLayer?.pixels?.facebook?.mobile_bridge_app_id),pmwDataLayer.pixels.facebook.loaded=!0}catch(r){console.error(r)}var a,t,r,o,n,i,s},e.getUserIdentifiersForFb=()=>{let e={};return pmwDataLayer?.user?.id?.raw&&(e.external_id=pmwDataLayer.user.id.raw),pmwDataLayer?.order?.user_id&&(e.external_id=pmwDataLayer.order.user_id),pmwDataLayer?.user?.email?.facebook&&(e.em=pmwDataLayer.user.email.facebook),pmwDataLayer?.order?.billing_email_hashed&&(e.em=pmwDataLayer.order.billing_email_hashed),pmwDataLayer?.user?.first_name?.facebook&&(e.fn=pmwDataLayer.user.first_name.facebook),pmwDataLayer?.order?.billing_first_name&&(e.fn=pmwDataLayer.order.billing_first_name.toLowerCase()),pmwDataLayer?.user?.last_name?.facebook&&(e.ln=pmwDataLayer.user.last_name.facebook),pmwDataLayer?.order?.billing_last_name&&(e.ln=pmwDataLayer.order.billing_last_name.toLowerCase()),pmwDataLayer?.user?.phone?.facebook&&(e.ph=pmwDataLayer.user.phone.facebook),pmwDataLayer?.order?.billing_phone&&(e.ph=pmwDataLayer.order.billing_phone.replace("+","")),pmwDataLayer?.user?.city?.facebook&&(e.ct=pmwDataLayer.user.city.facebook),pmwDataLayer?.order?.billing_city&&(e.ct=pmwDataLayer.order.billing_city.toLowerCase().replace(/ /g,"")),pmwDataLayer?.user?.state?.facebook&&(e.st=pmwDataLayer.user.state.facebook),pmwDataLayer?.order?.billing_state&&(e.st=pmwDataLayer.order.billing_state.toLowerCase().replace(/[a-zA-Z]{2}-/,"")),pmwDataLayer?.user?.postcode?.facebook&&(e.zp=pmwDataLayer.user.postcode.facebook),pmwDataLayer?.order?.billing_postcode&&(e.zp=pmwDataLayer.order.billing_postcode),pmwDataLayer?.user?.country?.facebook&&(e.country=pmwDataLayer.user.country.facebook),pmwDataLayer?.order?.billing_country&&(e.country=pmwDataLayer.order.billing_country.toLowerCase()),e},e.getFbRandomEventId=()=>(Math.random()+1).toString(36).substring(2),e.getFbUserData=()=>(a={...a,...e.getFbUserDataFromBrowser()},a),e.isFbAdvancedMatchingEnabled=()=>!!pmwDataLayer?.pixels?.facebook?.advanced_matching,e.waitForFbp=(a=2e3,r=50)=>{let o=e.getCookie("_fbp");return e.isValidFbp(o)?Promise.resolve(o):t||(t=new Promise(o=>{let n=0;const i=()=>{let s=e.getCookie("_fbp");return e.isValidFbp(s)?(e.console.log("Facebook Pixel: _fbp cookie found after "+n+"ms"),t=null,void o(s)):(n+=r,n>=a?(e.console.log("Facebook Pixel: Timeout waiting for _fbp cookie after "+a+"ms"),t=null,void o(null)):void setTimeout(i,r))};i()}),t)},e.setFbUserData=async()=>{await e.waitForFbp(),a=e.getFbUserDataFromBrowser()},e.getFbUserDataFromBrowser=()=>{let a={},t=e.getCookie("_fbp");e.isValidFbp(t)&&(a.fbp=t);let r=e.getCookie("_fbc")||e.retrieveData("fbclid");e.isValidFbc(r)&&(a.fbc=r),e.isFbAdvancedMatchingEnabled()&&(pmwDataLayer?.user?.email?.facebook&&(a.em=pmwDataLayer.user.email.facebook),pmwDataLayer?.user?.phone?.facebook&&(a.ph=pmwDataLayer.user.phone.facebook),pmwDataLayer?.user?.first_name?.facebook&&(a.fn=pmwDataLayer.user.first_name.facebook),pmwDataLayer?.user?.last_name?.facebook&&(a.ln=pmwDataLayer.user.last_name.facebook),pmwDataLayer?.user?.city?.facebook&&(a.ct=pmwDataLayer.user.city.facebook),pmwDataLayer?.user?.state?.facebook&&(a.st=pmwDataLayer.user.state.facebook),pmwDataLayer?.user?.postcode?.facebook&&(a.zp=pmwDataLayer.user.postcode.facebook),pmwDataLayer?.user?.country?.facebook&&(a.country=pmwDataLayer.user.country.facebook),pmwDataLayer?.user?.id?.raw&&(a.external_id=pmwDataLayer.user.id.raw)),navigator.userAgent&&(a.client_user_agent=navigator.userAgent);const o=e.retrieveData("client_ip")||e.retrieveData("ipv6")||e.retrieveData("ip");return o&&e.isValidIpAddress&&e.isValidIpAddress(o)&&(a.client_ip_address=o),a},e.isFbpSet=()=>!!e.getCookie("_fbp"),e.isValidFbp=e=>new RegExp(/^fb\.[0-2]\.\d{13}\.\d{8,20}$/).test(e),e.isValidFbc=e=>new RegExp(/^fb\.[0-2]\.\d{13}\.[\da-zA-Z_-]{8,}/).test(e),e.fbGetProductDataForCapiEvent=e=>({content_type:"product",content_name:e.name,content_ids:[e.dyn_r_ids[pmwDataLayer.pixels.facebook.dynamic_remarketing.id_type]],value:parseFloat(e.quantity*e.price),currency:e.currency}),e.facebookContentIds=()=>{let e=[];return Object.values(pmwDataLayer.order.items).forEach(a=>{pmwDataLayer?.shop?.variations_output&&0!==a.variation_id?e.push(String(pmwDataLayer.products[a.variation_id].dyn_r_ids[pmwDataLayer.pixels.facebook.dynamic_remarketing.id_type])):e.push(String(pmwDataLayer.products[a.id].dyn_r_ids[pmwDataLayer.pixels.facebook.dynamic_remarketing.id_type]))}),e},e.trackCustomFacebookEvent=(a,t={})=>{try{if(!pmwDataLayer?.pixels?.facebook?.loaded)return;let r=e.getFbRandomEventId();fbq("trackCustom",a,t,{eventID:r}),e.console.log("Facebook Pixel: Custom event sent",a,t);let o={facebook:{event_name:a,event_id:r,user_data:e.getFbUserData(),event_source_url:window.location.href}};Object.keys(t).length&&(o.facebook.custom_data=t),e.sendEventPayloadToServer(o)}catch(e){console.error(e)}},e.fbGetContentIdsFromCart=()=>{let e=[];for(const a in pmwDataLayer.cart)e.push(pmwDataLayer.products[a].dyn_r_ids[pmwDataLayer.pixels.facebook.dynamic_remarketing.id_type]);return e},e.canFireFbq=()=>!!pmwDataLayer?.pixels?.facebook?.loaded&&!!e.consent.categories.get().marketing,e.canNotFireFbq=()=>!e.canFireFbq()}(window.pmw=window.pmw||{},jQuery)},546(){!function(e){const a={async adapt(a,t,r){if(!pmwDataLayer?.pixels?.facebook?.pixel_id)return null;const o={page_view:this.adaptPageView,add_to_cart:this.adaptAddToCart,view_item:this.adaptViewItem,begin_checkout:this.adaptBeginCheckout,add_payment_info:this.adaptAddPaymentInfo,add_to_wishlist:this.adaptAddToWishlist,search:this.adaptSearch,purchase:this.adaptPurchase,login:this.adaptLogin}[t];if(!o)return e.console.log(`No Facebook adapter for event: ${t}`),null;try{return await o.call(this,a,r)}catch(a){return e.console.error(`Facebook adapter error for ${t}:`,a),null}},async getBaseData(a){await e.waitForFbp();const t={event_id:e.getFbRandomEventId(),user_data:e.getFbUserData(),event_source_url:a.url};return a.referrer&&(t.referrer_url=a.referrer),t},async adaptPageView(e,a){return{event_name:"PageView",...await this.getBaseData(a),custom_data:{}}},async adaptAddToCart(a,t){const r=a.product;return{event_name:"AddToCart",...await this.getBaseData(t),custom_data:e.fbGetProductDataForCapiEvent(r)}},async adaptViewItem(a,t){const r=a.product,o={event_name:"ViewContent",...await this.getBaseData(t),custom_data:{}};return r&&(o.custom_data=e.fbGetProductDataForCapiEvent(r)),o},async adaptBeginCheckout(a,t){const r={event_name:"InitiateCheckout",...await this.getBaseData(t),custom_data:{}};return pmwDataLayer?.cart&&!jQuery.isEmptyObject(pmwDataLayer.cart)&&(r.custom_data={content_type:"product",content_ids:e.fbGetContentIdsFromCart(),value:e.getCartValue(),currency:pmwDataLayer.shop.currency}),r},async adaptAddPaymentInfo(e,a){return{event_name:"AddPaymentInfo",...await this.getBaseData(a),custom_data:{}}},async adaptAddToWishlist(a,t){const r=a.product;return{event_name:"AddToWishlist",...await this.getBaseData(t),custom_data:e.fbGetProductDataForCapiEvent(r)}},async adaptSearch(a,t){return{event_name:"Search",...await this.getBaseData(t),custom_data:{search_string:e.getSearchTermFromUrl()}}},async adaptPurchase(a,t){if(!pmwDataLayer?.order)return e.console.error("Order data not available for Facebook Purchase event"),null;const r=await this.getBaseData(t);return r.event_id=pmwDataLayer.order.id.toString(),{event_name:"Purchase",...r,custom_data:{value:pmwDataLayer.order.value.marketing,currency:pmwDataLayer.order.currency,content_type:"product",content_ids:e.facebookContentIds()}}},adaptLogin:async(e,a)=>null};e.registerAdapter("facebook",a,{mode:"both",supportsS2S:!0,supportsEventDeduplication:!0,supportsPageViewS2S:!0,isActive:()=>!0===pmwDataLayer?.pixels?.facebook?.loaded})}(window.pmw=window.pmw||{},jQuery)},767(e,a,t){t(546),t(263),t(28)}}]);
//# sourceMappingURL=pixel-facebook.1aad8345.chunk.min.js.map