/*! Copyright 2025 SweetCode. All rights reserved. */(()=>{var e={348(){window.pmwAdminScriptLoaded=!0},605(){jQuery(function(){if("pmw"!==pmwGetPageId())return;let e=[],t={};if(jQuery(".section").closest("tr").hide(),jQuery(".section").each(function(){e.push({slug:jQuery(this).data("sectionSlug"),title:jQuery(this).data("sectionTitle"),badgeCount:jQuery(this).data("badgeCount")||0})}),jQuery(".subsection").each(function(){t[jQuery(this).data("sectionSlug")]=t[jQuery(this).data("sectionSlug")]||[],t[jQuery(this).data("sectionSlug")].push({title:jQuery(this).data("subsectionTitle"),slug:jQuery(this).data("subsectionSlug")})}),e.forEach(function(e){let t=e.badgeCount>0?'<span class="pmw-tab-badge">'+e.badgeCount+"</span>":"";jQuery(".nav-tab-wrapper").append('<a href="#" class="nav-tab" data-section-slug="'+e.slug+'">'+e.title+t+"</a>")}),jQuery(".nav-tab-wrapper").after(pmwCreateSubtabUlHtml(t)),jQuery(".nav-tab-wrapper a").on("click",function(n){n.preventDefault(),jQuery(this).addClass("nav-tab-active").siblings().removeClass("nav-tab-active");let a=jQuery(this).data("section-slug");pmwToggleSections(a,e),a in t&&jQuery("ul[data-section-slug="+a+"]").children(":first").trigger("click")}),jQuery(".pmw-subnav-li").on("click",function(e){e.preventDefault(),e.stopPropagation(),jQuery(this).addClass("pmw-subnav-li-active").removeClass("pmw-subnav-li-inactive").siblings().addClass("pmw-subnav-li-inactive").removeClass("pmw-subnav-li-active"),pmwToggleSubsection(jQuery(this).parent().data("section-slug"),jQuery(this).data("subsection-slug"))}),pmwGetSectionParams()){let e=pmwGetSectionParams();jQuery("a[data-section-slug="+e.section+"]").trigger("click"),!1!==e.subsection&&jQuery("ul[data-section-slug="+e.section+"]").children("[data-subsection-slug="+e.subsection+"]").trigger("click")}else jQuery("a[data-section-slug="+e[0].slug+"]").trigger("click")}),pmwCreateSubtabUlHtml=e=>{let t=Object.keys(e),n="";return t.forEach(function(t){n+='<ul class="pmw-subnav-tabs" data-section-slug="'+t+'">',e[t].forEach(function(e){n+='<li class="pmw-subnav-li pmw-subnav-li-inactive" style="cursor: pointer;" data-subsection-slug="'+e.slug+'">'+e.title+"</li>"}),n+="</ul>"}),n},pmwGetSectionParams=()=>{const e=window.location.search,t=new URLSearchParams(e);return!!t.get("section")&&{section:t.get("section"),subsection:t.get("subsection")}},pmwToggleSections=(e,t)=>{jQuery("#pmw_settings_form > h2").nextUntil(".submit").andSelf().hide(),jQuery(".pmw-subnav-tabs").hide(),jQuery(".pmw-subnav-tabs[data-section-slug="+e+"]").show();let n=t.findIndex(t=>t.slug===e);jQuery("div[data-section-slug="+e+"]").closest("table").prevAll("h2:first").next().nextUntil("h2, .submit").andSelf().show(),pmwSetUrl(t[n].slug)},pmwToggleSubsection=(e,t)=>{jQuery("#pmw_settings_form > h2").nextUntil(".submit").andSelf().hide(),jQuery("[data-section-slug="+e+"][data-subsection-slug="+t+"]").closest("tr").siblings().andSelf().hide(),jQuery("[data-section-slug="+e+"][data-subsection-slug="+t+"]").closest("table").show(),jQuery("[data-section-slug="+e+"][data-subsection-slug="+t+"]").closest("tr").nextUntil(jQuery("[data-section-slug="+e+"][data-subsection-slug]").closest("tr")).show(),pmwSetUrl(e,t)},pmwSetUrl=(e,t="")=>{const n=window.location.search,a=new URLSearchParams(n);a.delete("section"),a.delete("subsection");let s="section="+e;s+=t?"&subsection="+t:"",history.pushState("","pmw"+e,document.location.pathname+"?page=pmw&"+s),jQuery('input[name ="_wp_http_referer"]').val(pmwGetAdminPath()+"?page=pmw&"+s+"&settings-updated=true")},pmwGetAdminPath=()=>new URL(jQuery("#wp-admin-canonical").attr("href")).pathname,pmwGetPageId=()=>{const e=window.location.search;return new URLSearchParams(e).get("page")},jQuery(document).on("click","[data-section-slug]",function(){["opportunities","diagnostics","support"].includes(jQuery(this).data("section-slug"))?jQuery(".submit").hide():jQuery(".submit").show()}),jQuery(document).on("click",".advanced-section-link",e=>{e.preventDefault();let t=jQuery(e.currentTarget).data("as-section"),n=jQuery(e.currentTarget).data("as-subsection");jQuery(`a[data-section-slug=${t}]`).trigger("click"),jQuery(`ul[data-section-slug=${t}]`).children(`[data-subsection-slug=${n}]`).trigger("click")})},992(){jQuery(function(){jQuery("#debug-info-button").on("click",()=>{const e=jQuery("#debug-info-textarea")[0];e.select(),e.setSelectionRange(0,99999),pmw.copyTextToClipboard(jQuery("#debug-info-textarea").val());const t=jQuery("#debug-info-success");t.fadeIn(200),setTimeout(()=>t.fadeOut(200),3e3)}),jQuery("#pmw-pro-version-demo").on("click",function(){jQuery("#submit").trigger("click")}),document.getElementById("json-settings-file-input")&&document.getElementById("json-settings-file-input").addEventListener("change",pmw.readSettingsFile,!1),document.getElementById("ga4-data-api-credentials-upload-button")&&document.getElementById("ga4-data-api-credentials-upload-button").addEventListener("change",pmw.readGa4DataApiCredentials,!1),document.getElementById("ga4-data-api-credentials-delete-button")&&document.getElementById("ga4-data-api-credentials-delete-button").addEventListener("click",()=>{pmw.saveGa4DataApiCredentialsToDb({})},!1),jQuery("#wgact_download_logs_zip").on("click",function(e){if(e.preventDefault(),jQuery(this).prop("disabled"))return;const t=jQuery(this).data("source"),n=jQuery(this),a=n.text();n.prop("disabled",!0).text("Downloading..."),fetch(pmwAdminApi.root+"pmw/v1/logs/download",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded","X-WP-Nonce":pmwAdminApi.nonce},body:new URLSearchParams({source:t}),credentials:"same-origin"}).then(e=>{if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);return e.blob()}).then(e=>{const t=window.URL.createObjectURL(e),s=document.createElement("a");s.href=t,s.download="pmw-logs-"+(new Date).toISOString().slice(0,19).replace(/:/g,"-")+".zip",document.body.appendChild(s),s.click(),window.URL.revokeObjectURL(t),document.body.removeChild(s),n.prop("disabled",!1).text(a)}).catch(e=>{console.error("Download error:",e),n.prop("disabled",!1).text(a),alert("Error downloading log files. Please try again.")})})}),function(e){e.saveSettingsToDisk=()=>{let t=document.getElementById("export-settings-json").value,n="unknown";try{let e=JSON.parse(t);e.timestamp&&(n=e.timestamp)}catch(e){console.warn("Could not extract timestamp from settings:",e)}t=t.replace(/\n/g,"\r\n");let a=new Blob([t],{type:"text/plain"}),s=document.createElement("a");s.download="pixel-manager-settings_"+n+"_"+e.getDateTimeFromTimestamp(n)+".json",s.href=window.URL.createObjectURL(a),s.target="_blank",s.style.display="none",document.body.appendChild(s),s.click(),document.body.removeChild(s)},e.getDateTimeFromTimestamp=t=>{if("unknown"===t||!t||isNaN(t))return e.getCurrentDateForFileName();let n=new Date(1e3*t);if(pmwAdminApi&&pmwAdminApi.timezone&&"number"==typeof pmwAdminApi.timezone.offset){let e=60*pmwAdminApi.timezone.offset*60*1e3;return n=new Date(n.getTime()+e),n.getUTCFullYear()+"."+("0"+(n.getUTCMonth()+1)).slice(-2)+"."+("0"+n.getUTCDate()).slice(-2)+"_"+("0"+n.getUTCHours()).slice(-2)+"-"+("0"+n.getUTCMinutes()).slice(-2)+"-"+("0"+n.getUTCSeconds()).slice(-2)}return n.getFullYear()+"."+("0"+(n.getMonth()+1)).slice(-2)+"."+("0"+n.getDate()).slice(-2)+"_"+("0"+n.getHours()).slice(-2)+"-"+("0"+n.getMinutes()).slice(-2)+"-"+("0"+n.getSeconds()).slice(-2)},e.getCurrentDateForFileName=()=>{let e=new Date;if(pmwAdminApi&&pmwAdminApi.timezone&&"number"==typeof pmwAdminApi.timezone.offset){let t=60*pmwAdminApi.timezone.offset*60*1e3;return e=new Date(e.getTime()+t),e.getUTCFullYear()+"."+("0"+(e.getUTCMonth()+1)).slice(-2)+"."+("0"+e.getUTCDate()).slice(-2)+"_"+("0"+e.getUTCHours()).slice(-2)+"-"+("0"+e.getUTCMinutes()).slice(-2)+"-"+("0"+e.getUTCSeconds()).slice(-2)}return e.getFullYear()+"."+("0"+(e.getMonth()+1)).slice(-2)+"."+("0"+e.getDate()).slice(-2)+"_"+("0"+e.getHours()).slice(-2)+"-"+("0"+e.getMinutes()).slice(-2)+"-"+("0"+e.getSeconds()).slice(-2)},e.readSettingsFile=t=>{let n=t.target.files[0];if(!n)return;let a=new FileReader;a.onload=function(t){try{JSON.parse(t.target.result)}catch(e){return document.getElementById("settings-upload-status-error").style.display="block",void(document.getElementById("settings-upload-status-error-message").innerHTML="Invalid JSON file.")}let n=JSON.parse(t.target.result);e.saveImportedSettingsToDb(n)},a.readAsText(n)},e.saveImportedSettingsToDb=e=>{fetch(pmwAdminApi.root+"pmw/v1/settings/",{method:"POST",credentials:"same-origin",headers:{"Content-Type":"application/json","X-WP-Nonce":pmwAdminApi.nonce},body:JSON.stringify(e)}).then(e=>e.json()).then(async e=>{e.success?(console.log(e),document.getElementById("settings-upload-status-success").style.display="block",await new Promise(e=>setTimeout(e,1e3)),window.location.reload()):(console.log(e),document.getElementById("settings-upload-status-error").style.display="block")}).catch(e=>{console.error(e),document.getElementById("settings-upload-status-error").style.display="block"})},e.restoreBackup=e=>{console.log("restoreBackup() - timestamp: ",e),fetch(pmwAdminApi.root+"pmw/v1/options-backup/"+e+"/restore",{method:"POST",credentials:"same-origin",headers:{"Content-Type":"application/json","X-WP-Nonce":pmwAdminApi.nonce}}).then(e=>e.json()).then(async e=>{e?.data?.message&&console.log("restoreBackup() - message: ",e.data.message),e.success?window.location.reload():alert(e.data.message)}).catch(e=>{console.error(e),alert(e.message)})},e.readGa4DataApiCredentials=t=>{let n=t.target.files[0];if(!n)return;let a=new FileReader;a.onload=function(t){try{JSON.parse(t.target.result)}catch(e){return document.getElementById("ga4-api-credentials-upload-status-error").style.display="block",void(document.getElementById("ga4-api-credentials-upload-status-error-message").innerHTML="Invalid JSON file.")}let n=JSON.parse(t.target.result);e.saveGa4DataApiCredentialsToDb(n)},a.readAsText(n)},e.deleteGa4DataApiCredentials=t=>{e.saveGa4DataApiCredentialsToDb({})},e.saveGa4DataApiCredentialsToDb=e=>{fetch(pmwAdminApi.root+"pmw/v1/ga4/data-api/credentials",{method:"POST",credentials:"same-origin",headers:{"Content-Type":"application/json","X-WP-Nonce":pmwAdminApi.nonce},body:JSON.stringify(e)}).then(e=>e.json()).then(async e=>{e.success?(console.log(e),document.getElementById("ga4-api-credentials-upload-status-success").style.display="block",window.location.reload()):(console.log(e),document.getElementById("ga4-api-credentials-upload-status-error").style.display="block",document.getElementById("ga4-api-credentials-upload-status-error-message").innerHTML="Error message: "+e.data.message)}).catch(e=>{console.error(e),document.getElementById("ga4-api-credentials-upload-status-error").style.display="block"})},e.getAiBotUrl=()=>{if(pmw_cody?.url)return pmw_cody.url},e.loadAiChatWindow=()=>{const t=document.getElementById("pmw-chatbot-panel"),n=document.getElementById("pmw-chatbot-iframe");t&&n?(n.src=e.getAiBotUrl(),document.body.classList.add("pmw-chatbot-open"),t.classList.add("pmw-chatbot-panel-open")):console.error("Chatbot panel elements not found")},e.closeChatbot=()=>{const e=document.getElementById("pmw-chatbot-panel");e&&(e.classList.remove("pmw-chatbot-panel-open"),document.body.classList.remove("pmw-chatbot-open"))},e.codyAvailable=()=>!(void 0===window.pmw_cody||!window.pmw_cody?.available),e.ltvRecalculation=e=>{const t=e=>{let t=document.getElementsByClassName("ltv-message");for(let e=0;e<t.length;e++)t[e].style.display="none";document.getElementById("ltv-message-error").style.display="block",document.getElementById("ltv-message-error-text").innerHTML=e},n=()=>{let e=document.getElementsByClassName("ltv-message");for(let t=0;t<e.length;t++)e[t].style.display="none";document.getElementById("ltv-message-error").style.display="none"};fetch(pmwAdminApi.root+"pmw/v1/ltv/",{method:"POST",credentials:"same-origin",headers:{"Content-Type":"application/json","X-WP-Nonce":pmwAdminApi.nonce},body:JSON.stringify({action:e.target.dataset.action})}).then(e=>e.json()).then(e=>{e.success?(console.log(e),e.data.status.is_scheduled&&(n(),(()=>{let e=document.getElementsByClassName("ltv-button-text");for(let t=0;t<e.length;t++)e[t].style.display="none";document.getElementById("ltv-instant-recalculation-button-text").style.display="block"})(),document.getElementById("ltv-schedule-recalculation-confirmation-message").style.display="block"),e.data.status.is_running&&(document.getElementById("wgact_ltv_recalculation").disabled=!0,n(),document.getElementById("ltv-running-recalculation-confirmation-message").style.display="block"),e.data.status.is_running||e.data.status.is_scheduled||t(e.data.message)):(console.error(e),t(e.data.message))}).catch(e=>{console.error(e),t(e)})},e.copyTextToClipboard=e=>{navigator.clipboard.writeText(e).catch(e=>{console.error("Failed to copy: ",e)})}}(window.pmw=window.pmw||{},jQuery),document.addEventListener("DOMContentLoaded",()=>{if(pmw.codyAvailable()){const e=document.getElementById("pmw-chatbot-widget");e&&(e.style.display="block");const t=document.getElementById("pmw-chat-li");t&&(t.style.display="list-item");const n=document.getElementById("pmw-chatbot-toggle"),a=document.getElementById("pmw-chatbot-close");n&&n.addEventListener("click",e=>{e.preventDefault(),pmw.loadAiChatWindow()}),a&&a.addEventListener("click",e=>{e.preventDefault(),pmw.closeChatbot()}),document.addEventListener("keydown",e=>{"Escape"===e.key&&pmw.closeChatbot()})}else console.log("DOMContentLoaded - chatbot is not available")},!0),jQuery(()=>{document.querySelector("#wgact_ltv_recalculation")&&document.querySelector("#wgact_ltv_recalculation").addEventListener("click",e=>{e.preventDefault(),pmw.ltvRecalculation(e)}),document.querySelector("#pmw_stop_ltv_calculation")&&document.querySelector("#pmw_stop_ltv_calculation").addEventListener("click",e=>{e.preventDefault(),pmw.ltvRecalculation(e)}),jQuery(()=>{jQuery(document).on("click",".pmw-restore-backup-button",function(e){e.preventDefault();const t=jQuery(this).data("timestamp");t&&pmw.restoreBackup(t)})})}),jQuery(()=>{document.querySelector("#wgact_copy_log_file_links")&&document.querySelector("#wgact_copy_log_file_links").addEventListener("click",e=>{e.preventDefault();const t=JSON.parse(e.target.dataset.links);let n="";for(let e=0,a=t.length;e<a;e++)n+=t[e]+"\n";pmw.copyTextToClipboard(n);let a=document.getElementById("wgact_copy_log_file_links");a.style.width=getComputedStyle(a).width;const s=a.innerHTML;a.innerHTML=e.target.dataset.textCopied,setTimeout(function(){a.innerHTML=s},3e3)})}),jQuery(()=>{jQuery(document).on("keydown","input, textarea, select",function(e){if("Enter"===e.key&&!e.shiftKey&&!e.ctrlKey&&!e.altKey){const t=jQuery(e.target);if(t.is("input")&&t.closest("form").length>0){const n=t.closest("form")[0],a=jQuery(n).find("#submit");a.length>0&&(e.preventDefault(),a.click())}}})})}},t={};function n(a){var s=t[a];if(void 0!==s)return s.exports;var o=t[a]={exports:{}};return e[a](o,o.exports,n),o.exports}n(992),n(348),n(605)})();
//# sourceMappingURL=pmw-admin.p1.min.js.map